# Ring-2025-演进规划

> [!TIP|label:tip]
>
> 致开发者：
>
> 不要觉得自己做的编译器没有气候，编译器是工业软件，需耐住寂寞，长时间积累。
> 

## 一、项目组织方案
1. 一个package中支持多个源代码文件，main package只能有一个文件，方便 ring run 命令
2. 每个文件中支持定义多个global 块，能够自动分析初始化顺序
3. import 导入支持别名
4. 支持使用import导入的全局变量，类定义
5. 被import的package中，支持 derive native函数
6. 比较类定义，类的类型是否一致
7. 支持并发编译，提升编译速度
8. 设计字节码文件，能够导出一个大的压缩字节码文件，能够解析，能够方便进行一键分发
9. 前端后端的解耦
10. 支持linux macos windows
11. 设计项目的组织、编译、链接

## 二、动态类型分配
1. 落地增量式垃圾回收算法、验证算法的正确性
2. 优化类的内存排布
3. 多维数组+类的内存排布
4. 优化数据的内存排布
5. free-value的内存排布
6. 理清用户行为的深度copy、浅copy和虚拟机层面的深度copy、浅copy

## 三、数据类型和运算
1. string 支持更多的标准库操作：切片，find prefix suffix split join
2. 支持小string内存优化
3. 支持string常量去重优化
4. 多行string
5. string的format
6. string 支持 utf-8
7. 基础数据类型的隐式转换，显式转换
8. 类对象的比较
9. 括号运算符
10. 指针和引用
11. 无符号类型
12. 十六进制类型常量数据解析
13. 新数据类型：元组、枚举
14. 放弃字符串拼接运算符 .. , 直接使用+

## 四、函数 方法 匿名函数 闭包
1. return语句的强制检查
2. 匿名函数赋值给field
3. 方法赋值给匿名函数
4. 捕获是值捕获还是引用捕获

## 五、控制语句
1. 优化 return break continue 语句
   1. return 与函数定义的不符合，控制语句中 不可能return
2. 优化 for-range 对应的语句和字节码
3. 思考错误处理方式，不能跟golang一样垃圾
4. defer语句对应的字节码优化

## 六、协程
1. 协程之间传递数据、共享数据
2. 协程与标准库，io net，异步
3. 支持多协程的并发式调度
4. 协程绑定cpu
5. 协程模型：唤醒、调度、回收

## 七、标准库
1. io
2. net
3. json
4. curl

## 八、工具链
1. 优化rdb原生调试工具
2. 如何用开发一个vscode ring语言调试插件，dap协议

## 九、优化编译流程和编译报错提示

1. 创建语法树
2. 语义补全，补全定义，引用（当前fix ast的功能）
3. 语义check+语法树fix裁剪优化：可以积累错误的数量，一个函数内错误不能超过5个。可以以函数为单元进行并发语法分析
4. 生成字节码



-----------------------------
